<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mcgf">
<title>Steps for fitting an `mcgf` object • mcgf</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Steps for fitting an `mcgf` object">
<meta property="og:description" content="mcgf">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mcgf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/mcgf.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/mcgf_rs.html">Steps for fitting an `mcgf_rs` object</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tianxia-jia/mcgf/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Steps for fitting an `mcgf` object</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tianxia-jia/mcgf/blob/HEAD/vignettes/mcgf.Rmd" class="external-link"><code>vignettes/mcgf.Rmd</code></a></small>
      <div class="d-none name"><code>mcgf.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>mcgf</code> package contains useful functions to simulate
Markov chain Gaussian fields (MCGF) and regime-switching Markov chain
Gaussian fields (RS-MCGF) with covariance structures of the Gneiting
class <span class="citation">(Gneiting 2002)</span>. It also provides
useful tools to estimate the parameters by weighted least squares (WLS)
and maximum likelihood estimation (MLE). The <code>mcgf</code> function
can be used to fit covariance models and obtain Kriging forecasts. A
typical workflow for fitting a non-regime-switching mcgf is given
below.</p>
<ol style="list-style-type: decimal">
<li>Create an <code>mcgf</code> object by providing a dataset and the
corresponding locations/distances</li>
<li>Calculate auto- and cross-correlations.</li>
<li>Fit the base covariance model which is a fully symmetric model.</li>
<li>Fit the Lagrangian model to account for asymmetry, if
necessary.</li>
<li>Obtain Kriging forecasts.</li>
<li>Obtain Kriging forecasts for new locations given their
coordinates.</li>
</ol>
<p>We will demonstrate the use of <code>mcgf</code> by an example
below.</p>
</div>
<div class="section level2">
<h2 id="irish-wind">Irish Wind<a class="anchor" aria-label="anchor" href="#irish-wind"></a>
</h2>
<p>The Ireland wind data contains daily wind speeds for 1961-1978 at 11
synoptic meteorological stations in the Republic of Ireland. It is
available in the <code>gstat</code> package and is also imported to
<code>mcgf</code>. To view the details on this dataset, run
<code><a href="../reference/wind.html">help(wind)</a></code>. The object <code>wind</code> contains the wind
speeds data as well as the locations of the stations.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tianxia-jia/mcgf" class="external-link">mcgf</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">wind</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">wind</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;         time      VAL      BEL       CLA      SHA      ROC      BIR      MUL</span></span>
<span><span class="co">#&gt; 1 1961-01-01 7.696089 9.517222 5.2730556 7.181644 7.737244 5.077567 5.571433</span></span>
<span><span class="co">#&gt; 2 1961-01-02 8.683822 9.023356 5.1650222 6.492289 7.567478 3.945789 5.036411</span></span>
<span><span class="co">#&gt; 3 1961-01-03 8.683822 6.559167 4.1361333 5.746344 9.517222 3.174122 4.372778</span></span>
<span><span class="co">#&gt; 4 1961-01-04 3.410767 2.808867 0.9208556 2.335578 5.442822 1.481600 2.999211</span></span>
<span><span class="co">#&gt; 5 1961-01-05 6.816389 6.646622 3.3644667 5.509700 6.857544 4.223589 5.617733</span></span>
<span><span class="co">#&gt; 6 1961-01-06 4.177289 4.177289 2.2738444 2.762567 6.795811 2.315000 3.688567</span></span>
<span><span class="co">#&gt;        MAL      KIL      CLO      DUB</span></span>
<span><span class="co">#&gt; 1 7.737244 4.779189 6.471711 7.032456</span></span>
<span><span class="co">#&gt; 2 7.114767 3.343889 4.974678 5.916111</span></span>
<span><span class="co">#&gt; 3 6.538589 5.211322 3.945789 5.787500</span></span>
<span><span class="co">#&gt; 4 5.597156 2.356156 3.024933 4.439656</span></span>
<span><span class="co">#&gt; 5 6.085878 3.174122 5.319356 6.132178</span></span>
<span><span class="co">#&gt; 6 6.775233 3.431344 3.858333 5.489122</span></span>
<span><span class="va">wind</span><span class="op">$</span><span class="va">locations</span></span>
<span><span class="co">#&gt;            lon      lat</span></span>
<span><span class="co">#&gt; VAL -10.250000 51.93333</span></span>
<span><span class="co">#&gt; BEL -10.000000 54.23333</span></span>
<span><span class="co">#&gt; CLA  -8.983333 53.71667</span></span>
<span><span class="co">#&gt; SHA  -8.916667 52.70000</span></span>
<span><span class="co">#&gt; ROC  -8.250000 51.80000</span></span>
<span><span class="co">#&gt; BIR  -7.883333 53.08333</span></span>
<span><span class="co">#&gt; MUL  -7.366667 53.53333</span></span>
<span><span class="co">#&gt; MAL  -7.333333 55.36667</span></span>
<span><span class="co">#&gt; KIL  -7.266667 52.66667</span></span>
<span><span class="co">#&gt; CLO  -7.233333 54.18333</span></span>
<span><span class="co">#&gt; DUB  -6.250000 53.43333</span></span></code></pre></div>
<div class="section level3">
<h3 id="data-de-treding">Data De-treding<a class="anchor" aria-label="anchor" href="#data-de-treding"></a>
</h3>
<p>To fit covariance models on <code>wind</code>, the first step is to
load the data set and de-trend the data to have a mean-zero time series.
We will follow the data de-trending procedure in <span class="citation">Gneiting, Genton, and Guttorp (2006)</span>.</p>
<ol style="list-style-type: decimal">
<li>We start with removing the leap day and take the square-root
transformation. To do this we need to use the <code>lubridate</code>
package.</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("lubridate")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="va">ind_leap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html" class="external-link">month</a></span><span class="op">(</span><span class="va">wind</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">time</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html" class="external-link">day</a></span><span class="op">(</span><span class="va">wind</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">time</span><span class="op">)</span> <span class="op">==</span> <span class="fl">29</span></span>
<span><span class="va">wind_de</span> <span class="op">&lt;-</span> <span class="va">wind</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="op">!</span><span class="va">ind_leap</span>, <span class="op">]</span></span>
<span><span class="va">wind_de</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">wind_de</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Next, we split the data into training and test datasets, where
training contains data in 1961-1970 and test spans 1971-1978.</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">is_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">wind_de</span><span class="op">$</span><span class="va">time</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">1970</span></span>
<span><span class="va">wind_train</span> <span class="op">&lt;-</span> <span class="va">wind_de</span><span class="op">[</span><span class="va">is_train</span>, <span class="op">]</span></span>
<span><span class="va">wind_test</span> <span class="op">&lt;-</span> <span class="va">wind_de</span><span class="op">[</span><span class="op">!</span><span class="va">is_train</span>, <span class="op">]</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>We will estimate and remove the annual trend for the training
dataset. The annual trend is the daily averages across the training
years. We will use the <code>dplyr</code> package for this task.</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("dplyr")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co"># Estimate annual trend</span></span>
<span><span class="va">avg_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    month <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html" class="external-link">month</a></span><span class="op">(</span><span class="va">wind_train</span><span class="op">$</span><span class="va">time</span><span class="op">)</span>,</span>
<span>    day <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html" class="external-link">day</a></span><span class="op">(</span><span class="va">wind_train</span><span class="op">$</span><span class="va">time</span><span class="op">)</span>,</span>
<span>    ws <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">wind_train</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">trend_train</span> <span class="op">&lt;-</span> <span class="va">avg_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">month</span>, <span class="va">day</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>trend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ws</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Subtract annual trend</span></span>
<span><span class="va">trend_train2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">avg_train</span>, <span class="va">trend_train</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"month"</span>, <span class="st">"day"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">trend</span></span>
<span><span class="va">wind_train</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">wind_train</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">trend_train2</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>To obtain a mean-zero time series, we will subtract the station-wise
mean for each station.</li>
</ol>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Subtract station-wise mean</span></span>
<span><span class="va">mean_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">wind_train</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">wind_train</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sweep.html" class="external-link">sweep</a></span><span class="op">(</span><span class="va">wind_train</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">2</span>, <span class="va">mean_train</span><span class="op">)</span></span>
<span><span class="va">wind_trend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    annual <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">trend_train</span><span class="op">)</span>,</span>
<span>    mean <span class="op">=</span> <span class="va">mean_train</span></span>
<span><span class="op">)</span></span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Finally, we will subtract the annual trend and station-wise mean
from the test dataset.</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">avg_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    month <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html" class="external-link">month</a></span><span class="op">(</span><span class="va">wind_test</span><span class="op">$</span><span class="va">time</span><span class="op">)</span>,</span>
<span>    day <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html" class="external-link">day</a></span><span class="op">(</span><span class="va">wind_test</span><span class="op">$</span><span class="va">time</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">trend_train3</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">avg_test</span>, <span class="va">trend_train</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"month"</span>, <span class="st">"day"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">trend</span></span>
<span><span class="va">wind_test</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">wind_test</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">trend_train3</span></span>
<span><span class="va">wind_test</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sweep.html" class="external-link">sweep</a></span><span class="op">(</span><span class="va">wind_test</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">2</span>, <span class="va">mean_train</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fitting-covariance-models">Fitting Covariance Models<a class="anchor" aria-label="anchor" href="#fitting-covariance-models"></a>
</h3>
<p>We will first fit pure spatial and temporal models, then the fully
symmetric model, and finally the general stationary model. First, we
will create an <code>mcgf</code> object and calculate auto- and cross-
correlations.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wind_mcgf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcgf.html">mcgf</a></span><span class="op">(</span><span class="va">wind_train</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, locations <span class="op">=</span> <span class="va">wind</span><span class="op">$</span><span class="va">locations</span>, longlat <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; `time` is not provided, assuming rows are equally spaced temporally.</span></span>
<span><span class="va">wind_mcgf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/acfs.mcgf.html">add_acfs</a></span><span class="op">(</span><span class="va">wind_mcgf</span>, lag_max <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">wind_mcgf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ccfs.mcgf.html">add_ccfs</a></span><span class="op">(</span><span class="va">wind_mcgf</span>, lag_max <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p>Here <code>acfs</code> actually refers to the mean auto-correlations
across the stations for each time lag. To view the calculated
<code>acfs</code>, we can run:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/acfs.html">acfs</a></span><span class="op">(</span><span class="va">wind_mcgf</span><span class="op">)</span></span>
<span><span class="co">#&gt;      lag0      lag1      lag2      lag3 </span></span>
<span><span class="co">#&gt; 1.0000000 0.5072739 0.2382621 0.1643998</span></span></code></pre></div>
<p>Similarly, we can view the <code>ccfs</code> by:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ccfs.html">ccfs</a></span><span class="op">(</span><span class="va">wind_mcgf</span><span class="op">)</span></span>
<span><span class="co">#&gt; , , lag0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           VAL       BEL       CLA       SHA       ROC       BIR       MUL</span></span>
<span><span class="co">#&gt; VAL 1.0000000 0.7076428 0.7588797 0.8299603 0.7962082 0.7719814 0.6688609</span></span>
<span><span class="co">#&gt; BEL 0.7076428 1.0000000 0.8471918 0.7432194 0.5795413 0.7650007 0.7371354</span></span>
<span><span class="co">#&gt; CLA 0.7588797 0.8471918 1.0000000 0.8520358 0.6994680 0.8777462 0.8410719</span></span>
<span><span class="co">#&gt; SHA 0.8299603 0.7432194 0.8520358 1.0000000 0.7960579 0.8865147 0.8239009</span></span>
<span><span class="co">#&gt; ROC 0.7962082 0.5795413 0.6994680 0.7960579 1.0000000 0.7592625 0.7305102</span></span>
<span><span class="co">#&gt; BIR 0.7719814 0.7650007 0.8777462 0.8865147 0.7592625 1.0000000 0.8841425</span></span>
<span><span class="co">#&gt; MUL 0.6688609 0.7371354 0.8410719 0.8239009 0.7305102 0.8841425 1.0000000</span></span>
<span><span class="co">#&gt; MAL 0.5153690 0.7087588 0.6818106 0.6121929 0.5357199 0.6411302 0.7375539</span></span>
<span><span class="co">#&gt; KIL 0.7333467 0.6487696 0.7772730 0.8236153 0.8338255 0.8406781 0.8414494</span></span>
<span><span class="co">#&gt; CLO 0.6718720 0.7697673 0.8511102 0.7759129 0.6876764 0.8436560 0.8699373</span></span>
<span><span class="co">#&gt; DUB 0.5967529 0.6498491 0.7420593 0.7361857 0.6862624 0.7812147 0.8609285</span></span>
<span><span class="co">#&gt;           MAL       KIL       CLO       DUB</span></span>
<span><span class="co">#&gt; VAL 0.5153690 0.7333467 0.6718720 0.5967529</span></span>
<span><span class="co">#&gt; BEL 0.7087588 0.6487696 0.7697673 0.6498491</span></span>
<span><span class="co">#&gt; CLA 0.6818106 0.7772730 0.8511102 0.7420593</span></span>
<span><span class="co">#&gt; SHA 0.6121929 0.8236153 0.7759129 0.7361857</span></span>
<span><span class="co">#&gt; ROC 0.5357199 0.8338255 0.6876764 0.6862624</span></span>
<span><span class="co">#&gt; BIR 0.6411302 0.8406781 0.8436560 0.7812147</span></span>
<span><span class="co">#&gt; MUL 0.7375539 0.8414494 0.8699373 0.8609285</span></span>
<span><span class="co">#&gt; MAL 1.0000000 0.5892218 0.7568132 0.7145366</span></span>
<span><span class="co">#&gt; KIL 0.5892218 1.0000000 0.7934818 0.7770512</span></span>
<span><span class="co">#&gt; CLO 0.7568132 0.7934818 1.0000000 0.8161496</span></span>
<span><span class="co">#&gt; DUB 0.7145366 0.7770512 0.8161496 1.0000000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , lag1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           VAL       BEL       CLA       SHA       ROC       BIR       MUL</span></span>
<span><span class="co">#&gt; VAL 0.4739681 0.4078097 0.3734029 0.4028977 0.3406302 0.3871317 0.3171416</span></span>
<span><span class="co">#&gt; BEL 0.3843919 0.5310138 0.4208376 0.3899411 0.2819817 0.4000168 0.3695143</span></span>
<span><span class="co">#&gt; CLA 0.4164508 0.4814516 0.4993218 0.4450647 0.3244728 0.4521809 0.4020938</span></span>
<span><span class="co">#&gt; SHA 0.4719522 0.4646048 0.4689832 0.5137855 0.3883962 0.4677375 0.4100365</span></span>
<span><span class="co">#&gt; ROC 0.4706594 0.3793417 0.3852120 0.4285917 0.4442973 0.4113073 0.3590478</span></span>
<span><span class="co">#&gt; BIR 0.4725125 0.4964189 0.4986726 0.4927316 0.3919890 0.5409202 0.4557624</span></span>
<span><span class="co">#&gt; MUL 0.4438395 0.5082231 0.5039360 0.4898975 0.4056061 0.5097809 0.5228395</span></span>
<span><span class="co">#&gt; MAL 0.3550724 0.4616666 0.4118390 0.3918386 0.3360198 0.3792364 0.4182625</span></span>
<span><span class="co">#&gt; KIL 0.4867586 0.4607927 0.4866086 0.4964729 0.4299541 0.4930438 0.4430179</span></span>
<span><span class="co">#&gt; CLO 0.4390459 0.5117641 0.5057839 0.4686427 0.3853159 0.4904330 0.4549374</span></span>
<span><span class="co">#&gt; DUB 0.4333070 0.4698080 0.4829445 0.4819004 0.4349093 0.4860929 0.4858079</span></span>
<span><span class="co">#&gt;           MAL       KIL       CLO       DUB</span></span>
<span><span class="co">#&gt; VAL 0.2712570 0.2917876 0.3248601 0.2900024</span></span>
<span><span class="co">#&gt; BEL 0.3554572 0.3012227 0.3806926 0.3179568</span></span>
<span><span class="co">#&gt; CLA 0.3289562 0.3458138 0.4112028 0.3569920</span></span>
<span><span class="co">#&gt; SHA 0.3203410 0.3834180 0.4088611 0.3736715</span></span>
<span><span class="co">#&gt; ROC 0.2950458 0.3540329 0.3479210 0.3484134</span></span>
<span><span class="co">#&gt; BIR 0.3408605 0.3973215 0.4505508 0.3984836</span></span>
<span><span class="co">#&gt; MUL 0.4151149 0.4232129 0.4664284 0.4434980</span></span>
<span><span class="co">#&gt; MAL 0.5296408 0.3105146 0.4036000 0.4002747</span></span>
<span><span class="co">#&gt; KIL 0.3227371 0.4642266 0.4387080 0.3981810</span></span>
<span><span class="co">#&gt; CLO 0.4032414 0.4076724 0.5190745 0.4289406</span></span>
<span><span class="co">#&gt; DUB 0.4428008 0.4300411 0.4765407 0.5409250</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , lag2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           VAL       BEL       CLA       SHA       ROC       BIR       MUL</span></span>
<span><span class="co">#&gt; VAL 0.2011319 0.1973159 0.1630851 0.1871285 0.1489858 0.1943355 0.1492425</span></span>
<span><span class="co">#&gt; BEL 0.1713197 0.2588323 0.1891480 0.1936055 0.1240906 0.2020276 0.1806373</span></span>
<span><span class="co">#&gt; CLA 0.1585236 0.2132206 0.2247423 0.2000905 0.1184259 0.2115274 0.1763905</span></span>
<span><span class="co">#&gt; SHA 0.1938118 0.2298367 0.2157028 0.2391773 0.1589136 0.2265611 0.1844087</span></span>
<span><span class="co">#&gt; ROC 0.1765714 0.1716184 0.1421018 0.1764547 0.1696931 0.1742268 0.1451217</span></span>
<span><span class="co">#&gt; BIR 0.2020194 0.2401048 0.2278565 0.2262318 0.1628422 0.2765692 0.2136481</span></span>
<span><span class="co">#&gt; MUL 0.1862142 0.2487854 0.2182151 0.2159567 0.1694341 0.2448788 0.2510983</span></span>
<span><span class="co">#&gt; MAL 0.1555252 0.2110852 0.1623937 0.1691266 0.1462008 0.1585537 0.1853651</span></span>
<span><span class="co">#&gt; KIL 0.1743715 0.2068322 0.1970328 0.2091868 0.1495429 0.2192173 0.1882474</span></span>
<span><span class="co">#&gt; CLO 0.1835787 0.2349159 0.2190671 0.2138391 0.1511675 0.2355708 0.2042911</span></span>
<span><span class="co">#&gt; DUB 0.1856084 0.2176080 0.2022041 0.2148639 0.1950841 0.2234817 0.2150465</span></span>
<span><span class="co">#&gt;           MAL       KIL       CLO       DUB</span></span>
<span><span class="co">#&gt; VAL 0.1427551 0.1382869 0.1666310 0.1535865</span></span>
<span><span class="co">#&gt; BEL 0.1754907 0.1388237 0.1941650 0.1629718</span></span>
<span><span class="co">#&gt; CLA 0.1419690 0.1537041 0.1979937 0.1674888</span></span>
<span><span class="co">#&gt; SHA 0.1503395 0.1803397 0.2022438 0.1764521</span></span>
<span><span class="co">#&gt; ROC 0.1458883 0.1373046 0.1488279 0.1654739</span></span>
<span><span class="co">#&gt; BIR 0.1438303 0.1844782 0.2197392 0.1920556</span></span>
<span><span class="co">#&gt; MUL 0.1950942 0.1905402 0.2183714 0.2084112</span></span>
<span><span class="co">#&gt; MAL 0.2636079 0.1107242 0.1729375 0.1921164</span></span>
<span><span class="co">#&gt; KIL 0.1334084 0.1931797 0.1982144 0.1790683</span></span>
<span><span class="co">#&gt; CLO 0.1715671 0.1793731 0.2624348 0.2135477</span></span>
<span><span class="co">#&gt; DUB 0.2180694 0.1899728 0.2270066 0.2804169</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , lag3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            VAL       BEL        CLA        SHA        ROC        BIR        MUL</span></span>
<span><span class="co">#&gt; VAL 0.15186704 0.1424697 0.12263507 0.12486035 0.11217575 0.14386635 0.09991865</span></span>
<span><span class="co">#&gt; BEL 0.12223738 0.1854410 0.13490665 0.13169403 0.08728794 0.14207057 0.12397596</span></span>
<span><span class="co">#&gt; CLA 0.10549441 0.1408343 0.16084299 0.13066846 0.07914442 0.13859706 0.10865229</span></span>
<span><span class="co">#&gt; SHA 0.12004043 0.1511578 0.14232764 0.14961877 0.09888111 0.14670946 0.11247087</span></span>
<span><span class="co">#&gt; ROC 0.11051322 0.1022188 0.08007433 0.09282562 0.10856180 0.10063755 0.07957425</span></span>
<span><span class="co">#&gt; BIR 0.13309457 0.1594322 0.15267585 0.13773090 0.10595023 0.19194636 0.13771463</span></span>
<span><span class="co">#&gt; MUL 0.11364183 0.1682815 0.14195183 0.12747872 0.10407473 0.15372629 0.16630054</span></span>
<span><span class="co">#&gt; MAL 0.09065312 0.1431289 0.10244646 0.10197080 0.09770836 0.08625211 0.11386343</span></span>
<span><span class="co">#&gt; KIL 0.09511038 0.1179299 0.11535092 0.11479319 0.07924395 0.12369722 0.10034132</span></span>
<span><span class="co">#&gt; CLO 0.12004487 0.1584521 0.15581710 0.13825387 0.10650927 0.15601087 0.13152273</span></span>
<span><span class="co">#&gt; DUB 0.10526163 0.1331954 0.11965370 0.11622550 0.11602725 0.12380225 0.11590933</span></span>
<span><span class="co">#&gt;            MAL        KIL        CLO       DUB</span></span>
<span><span class="co">#&gt; VAL 0.11038186 0.09840820 0.12881956 0.1131093</span></span>
<span><span class="co">#&gt; BEL 0.11895940 0.09539470 0.13930407 0.1065024</span></span>
<span><span class="co">#&gt; CLA 0.08566429 0.10250903 0.13807158 0.1059626</span></span>
<span><span class="co">#&gt; SHA 0.10015324 0.11889068 0.14364630 0.1110210</span></span>
<span><span class="co">#&gt; ROC 0.10700118 0.08017778 0.09975703 0.1043980</span></span>
<span><span class="co">#&gt; BIR 0.09283539 0.12122167 0.15906405 0.1304590</span></span>
<span><span class="co">#&gt; MUL 0.13033344 0.11347989 0.14872192 0.1286318</span></span>
<span><span class="co">#&gt; MAL 0.19778972 0.05899522 0.10990283 0.1253038</span></span>
<span><span class="co">#&gt; KIL 0.07627083 0.11333371 0.12609113 0.1024267</span></span>
<span><span class="co">#&gt; CLO 0.10926382 0.12014806 0.20136056 0.1459052</span></span>
<span><span class="co">#&gt; DUB 0.14141118 0.10085759 0.14688397 0.1813353</span></span></code></pre></div>
<div class="section level4">
<h4 id="pure-spatial-model">Pure Spatial Model<a class="anchor" aria-label="anchor" href="#pure-spatial-model"></a>
</h4>
<p>The pure spatial model can be fitted using the <code>fit_base</code>
function. The results are actually obtained from the optimization
function <code>nlminb</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_spatial</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_base.html">fit_base</a></span><span class="op">(</span></span>
<span>    <span class="va">wind_mcgf</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"spatial"</span>,</span>
<span>    lag <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    par_init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>nugget <span class="op">=</span> <span class="fl">0.1</span>, c <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span>,</span>
<span>    par_fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>gamma <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fit_spatial</span><span class="op">$</span><span class="va">fit</span></span>
<span><span class="co">#&gt; $par</span></span>
<span><span class="co">#&gt;           c      nugget </span></span>
<span><span class="co">#&gt; 0.001326192 0.049136042 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $objective</span></span>
<span><span class="co">#&gt; [1] 1.742162</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $convergence</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $iterations</span></span>
<span><span class="co">#&gt; [1] 9</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $evaluations</span></span>
<span><span class="co">#&gt; function gradient </span></span>
<span><span class="co">#&gt;       23       24 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; [1] "relative convergence (4)"</span></span></code></pre></div>
<p>Here we set <code>gamma</code> to be 0.5 and it is not estimated
along with <code>c</code> or <code>nugget</code>. By default
<code>mcgf</code> provides two optimization functions:
<code>nlminb</code> and <code>optim</code>. Other optimization functions
are also supported as long as their first two arguments are initial
values for the parameters and a function to be minimized respectively
(same as that of <code>optim</code> and <code>nlminb</code>). Also, if
the argument names for upper and lower bounds are not <code>upper</code>
or <code>lower</code>, we can create a simple wrapper to “change”
them.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">Rsolnp</span><span class="op">)</span></span>
<span><span class="va">solnp2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pars</span>, <span class="va">fun</span>, <span class="va">lower</span>, <span class="va">upper</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/Rsolnp/man/solnp.html" class="external-link">solnp</a></span><span class="op">(</span><span class="va">pars</span>, <span class="va">fun</span>, LB <span class="op">=</span> <span class="va">lower</span>, UB <span class="op">=</span> <span class="va">upper</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">fit_spatial2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_base.html">fit_base</a></span><span class="op">(</span></span>
<span>    <span class="va">wind_mcgf</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"spatial"</span>,</span>
<span>    lag <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    par_init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>nugget <span class="op">=</span> <span class="fl">0.1</span>, c <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span>,</span>
<span>    par_fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>gamma <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    optim_fn <span class="op">=</span> <span class="st">"other"</span>,</span>
<span>    other_optim_fn <span class="op">=</span> <span class="st">"solnp2"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Iter: 1 fn: 1.7422    Pars:  0.001326 0.049164</span></span>
<span><span class="co">#&gt; Iter: 2 fn: 1.7422    Pars:  0.001326 0.049164</span></span>
<span><span class="co">#&gt; solnp--&gt; Completed in 2 iterations</span></span>
<span><span class="va">fit_spatial2</span><span class="op">$</span><span class="va">fit</span></span>
<span><span class="co">#&gt; $pars</span></span>
<span><span class="co">#&gt;           c      nugget </span></span>
<span><span class="co">#&gt; 0.001325958 0.049163635 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $convergence</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $values</span></span>
<span><span class="co">#&gt; [1] 2.539010 1.742162 1.742162</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $lagrange</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $hessian</span></span>
<span><span class="co">#&gt;            [,1]       [,2]</span></span>
<span><span class="co">#&gt; [1,] 58504276.4 391217.107</span></span>
<span><span class="co">#&gt; [2,]   391217.1   3319.562</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ineqx0</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $nfuneval</span></span>
<span><span class="co">#&gt; [1] 79</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $outer.iter</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $elapsed</span></span>
<span><span class="co">#&gt; Time difference of 0.009939194 secs</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $vscale</span></span>
<span><span class="co">#&gt; [1] 1 1 1</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="pure-temporal-model">Pure Temporal Model<a class="anchor" aria-label="anchor" href="#pure-temporal-model"></a>
</h4>
<p>The pure temporal can also be fitted by <code>fit_base</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_temporal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_base.html">fit_base</a></span><span class="op">(</span></span>
<span>    <span class="va">wind_mcgf</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"temporal"</span>,</span>
<span>    lag <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    par_init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fit_temporal</span><span class="op">$</span><span class="va">fit</span></span>
<span><span class="co">#&gt; $par</span></span>
<span><span class="co">#&gt;         a     alpha </span></span>
<span><span class="co">#&gt; 0.9774157 0.8053363 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $objective</span></span>
<span><span class="co">#&gt; [1] 0.0006466064</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $convergence</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $iterations</span></span>
<span><span class="co">#&gt; [1] 12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $evaluations</span></span>
<span><span class="co">#&gt; function gradient </span></span>
<span><span class="co">#&gt;       15       31 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; [1] "both X-convergence and relative convergence (5)"</span></span></code></pre></div>
<p>Before fitting the fully symmetric model, we need to store the fitted
spatial and temporal models to <code>wind_mcgf</code> using
<code>add_base</code>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wind_mcgf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_base.html">add_base</a></span><span class="op">(</span><span class="va">wind_mcgf</span>,</span>
<span>    fit_s <span class="op">=</span> <span class="va">fit_spatial</span>,</span>
<span>    fit_t <span class="op">=</span> <span class="va">fit_temporal</span>,</span>
<span>    sep <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="separable-model">Separable Model<a class="anchor" aria-label="anchor" href="#separable-model"></a>
</h4>
<p>We can also fit the pure spatial and temporal models all at once by
fitting a separable model:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_sep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_base.html">fit_base</a></span><span class="op">(</span></span>
<span>    <span class="va">wind_mcgf</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"sep"</span>,</span>
<span>    lag <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    par_init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>nugget <span class="op">=</span> <span class="fl">0.1</span>, c <span class="op">=</span> <span class="fl">0.001</span>, a <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    par_fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>gamma <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fit_sep</span><span class="op">$</span><span class="va">fit</span></span>
<span><span class="co">#&gt; $par</span></span>
<span><span class="co">#&gt;           c      nugget           a       alpha </span></span>
<span><span class="co">#&gt; 0.001309486 0.050562930 0.877171418 0.869117992 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $objective</span></span>
<span><span class="co">#&gt; [1] 2.838695</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $convergence</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $iterations</span></span>
<span><span class="co">#&gt; [1] 25</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $evaluations</span></span>
<span><span class="co">#&gt; function gradient </span></span>
<span><span class="co">#&gt;       54      121 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; [1] "relative convergence (4)"</span></span></code></pre></div>
<p>Once can also store this model to <code>wind_mcgf</code>, but to be
consistent with <span class="citation">Gneiting, Genton, and Guttorp
(2006)</span>, we will just use the estimates from the pure spatial and
temporal models to estimate the interaction parameter
<code>beta</code>.</p>
</div>
<div class="section level4">
<h4 id="fully-symmetric-model">Fully Symmetric Model<a class="anchor" aria-label="anchor" href="#fully-symmetric-model"></a>
</h4>
<p>When holding other parameters constant, the parameter
<code>beta</code> can be estimated by:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">par_sep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fit_spatial</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">par</span>, <span class="va">fit_temporal</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">par</span>, gamma <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">fit_fs</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="../reference/fit_base.html">fit_base</a></span><span class="op">(</span></span>
<span>        <span class="va">wind_mcgf</span>,</span>
<span>        model <span class="op">=</span> <span class="st">"fs"</span>,</span>
<span>        lag <span class="op">=</span> <span class="fl">3</span>,</span>
<span>        par_init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>beta <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>        par_fixed <span class="op">=</span> <span class="va">par_sep</span></span>
<span>    <span class="op">)</span></span>
<span><span class="va">fit_fs</span><span class="op">$</span><span class="va">fit</span></span>
<span><span class="co">#&gt; $par</span></span>
<span><span class="co">#&gt;      beta </span></span>
<span><span class="co">#&gt; 0.6232458 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $objective</span></span>
<span><span class="co">#&gt; [1] 2.858384</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $convergence</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $iterations</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $evaluations</span></span>
<span><span class="co">#&gt; function gradient </span></span>
<span><span class="co">#&gt;        6        7 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; [1] "relative convergence (4)"</span></span></code></pre></div>
<p>At this stage, we have fitted the base model, and we will store the
fully symmetric model as the base model and print the base model:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wind_mcgf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_base.html">add_base</a></span><span class="op">(</span><span class="va">wind_mcgf</span>, fit_base <span class="op">=</span> <span class="va">fit_fs</span>, old <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/model.html">model</a></span><span class="op">(</span><span class="va">wind_mcgf</span>, model <span class="op">=</span> <span class="st">"base"</span>, old <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt;                  Model</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt; - Time lag: 3 </span></span>
<span><span class="co">#&gt; - Scale of time lag: 1 </span></span>
<span><span class="co">#&gt; - Forecast horizon: 1 </span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt;             Old - not in use</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt; - Base-old model: sep </span></span>
<span><span class="co">#&gt; - Parameters:</span></span>
<span><span class="co">#&gt;           c      nugget       gamma           a       alpha </span></span>
<span><span class="co">#&gt; 0.001326192 0.049136042 0.500000000 0.977415717 0.805336266 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Fixed parameters:</span></span>
<span><span class="co">#&gt; gamma </span></span>
<span><span class="co">#&gt;   0.5 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Parameter estimation method: wls wls </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Optimization function: nlminb nlminb </span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt;                  Base</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt; - Base model: fs </span></span>
<span><span class="co">#&gt; - Parameters:</span></span>
<span><span class="co">#&gt;        beta           c      nugget           a       alpha       gamma </span></span>
<span><span class="co">#&gt; 0.623245823 0.001326192 0.049136042 0.977415717 0.805336266 0.500000000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Fixed parameters:</span></span>
<span><span class="co">#&gt;           c      nugget           a       alpha       gamma </span></span>
<span><span class="co">#&gt; 0.001326192 0.049136042 0.977415717 0.805336266 0.500000000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Parameter estimation method: wls </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Optimization function: nlminb</span></span></code></pre></div>
<p>The <code>old = TRUE</code> in <code>add_base</code> keeps the fitted
pure spatial and temporal models for records, and they are not used for
any further steps. It is recommended to keep the old model not only for
reproducibility, but to keep a history of fitted models.</p>
</div>
<div class="section level4">
<h4 id="lagrangian-model">Lagrangian Model<a class="anchor" aria-label="anchor" href="#lagrangian-model"></a>
</h4>
<p>We will fit a Lagrangian correlation function to model the westerly
wind:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_lagr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_lagr.html">fit_lagr</a></span><span class="op">(</span><span class="va">wind_mcgf</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"lagr_tri"</span>,</span>
<span>    par_init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>v1 <span class="op">=</span> <span class="fl">200</span>, lambda <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>    par_fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>v2 <span class="op">=</span> <span class="fl">0</span>, k <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fit_lagr</span><span class="op">$</span><span class="va">fit</span></span>
<span><span class="co">#&gt; $par</span></span>
<span><span class="co">#&gt;       lambda           v1 </span></span>
<span><span class="co">#&gt;   0.05595016 212.29485854 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $objective</span></span>
<span><span class="co">#&gt; [1] 2.662327</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $convergence</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $iterations</span></span>
<span><span class="co">#&gt; [1] 18</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $evaluations</span></span>
<span><span class="co">#&gt; function gradient </span></span>
<span><span class="co">#&gt;       21       54 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; [1] "relative convergence (4)"</span></span></code></pre></div>
<p>Finally we will store this model to <code>wind_mcgf</code> using
<code>add_lagr</code> and then print the final model:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wind_mcgf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_lagr.html">add_lagr</a></span><span class="op">(</span><span class="va">wind_mcgf</span>, fit_lagr <span class="op">=</span> <span class="va">fit_lagr</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/model.html">model</a></span><span class="op">(</span><span class="va">wind_mcgf</span>, old <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt;                  Model</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt; - Time lag: 3 </span></span>
<span><span class="co">#&gt; - Scale of time lag: 1 </span></span>
<span><span class="co">#&gt; - Forecast horizon: 1 </span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt;             Old - not in use</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt; - Base-old model: sep </span></span>
<span><span class="co">#&gt; - Parameters:</span></span>
<span><span class="co">#&gt;           c      nugget       gamma           a       alpha </span></span>
<span><span class="co">#&gt; 0.001326192 0.049136042 0.500000000 0.977415717 0.805336266 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Fixed parameters:</span></span>
<span><span class="co">#&gt; gamma </span></span>
<span><span class="co">#&gt;   0.5 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Parameter estimation method: wls wls </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Optimization function: nlminb nlminb </span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt;                  Base</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt; - Base model: fs </span></span>
<span><span class="co">#&gt; - Parameters:</span></span>
<span><span class="co">#&gt;        beta           c      nugget           a       alpha       gamma </span></span>
<span><span class="co">#&gt; 0.623245823 0.001326192 0.049136042 0.977415717 0.805336266 0.500000000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Fixed parameters:</span></span>
<span><span class="co">#&gt;           c      nugget           a       alpha       gamma </span></span>
<span><span class="co">#&gt; 0.001326192 0.049136042 0.977415717 0.805336266 0.500000000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Parameter estimation method: wls </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Optimization function: nlminb </span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt;               Lagrangian</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt; - Lagrangian model: lagr_tri </span></span>
<span><span class="co">#&gt; - Parameters:</span></span>
<span><span class="co">#&gt;       lambda           v1           v2            k </span></span>
<span><span class="co">#&gt;   0.05595016 212.29485854   0.00000000   2.00000000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Fixed parameters:</span></span>
<span><span class="co">#&gt; v2  k </span></span>
<span><span class="co">#&gt;  0  2 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Parameter estimation method: wls </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Optimization function: nlminb</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="simple-kriging">Simple Kriging<a class="anchor" aria-label="anchor" href="#simple-kriging"></a>
</h3>
<p>For the test dataset, we can obtain the simple kriging forecasts and
intervals for the empirical model, base model, and general stationary
model using the <code>krige</code> function:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">krige_emp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/krige.html">krige</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">wind_mcgf</span>,</span>
<span>    newdata <span class="op">=</span> <span class="va">wind_test</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"empirical"</span>,</span>
<span>    interval <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">krige_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/krige.html">krige</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">wind_mcgf</span>,</span>
<span>    newdata <span class="op">=</span> <span class="va">wind_test</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"base"</span>,</span>
<span>    interval <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">krige_stat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/krige.html">krige</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">wind_mcgf</span>,</span>
<span>    newdata <span class="op">=</span> <span class="va">wind_test</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>    interval <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Next, we can compute the root mean square error (RMSE), mean absolute
error (MAE), and the realized percentage of observations falling outside
the 95% PI (POPI) for these models on the test dataset.</p>
<div class="section level4">
<h4 id="rmse">RMSE<a class="anchor" aria-label="anchor" href="#rmse"></a>
</h4>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># RMSE</span></span>
<span><span class="va">rmse_emp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="op">(</span><span class="va">wind_test</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">krige_emp</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rmse_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="op">(</span><span class="va">wind_test</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">krige_base</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rmse_stat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="op">(</span><span class="va">wind_test</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">krige_stat</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rmse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Empirical"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rmse_emp</span><span class="op">)</span>,</span>
<span>    <span class="st">"Base"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rmse_base</span><span class="op">)</span>,</span>
<span>    <span class="st">"STAT"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rmse_stat</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">rmse</span></span>
<span><span class="co">#&gt; Empirical      Base      STAT </span></span>
<span><span class="co">#&gt; 0.4778542 0.4890462 0.4852207</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="mae">MAE<a class="anchor" aria-label="anchor" href="#mae"></a>
</h4>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mae_emp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">wind_test</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">krige_emp</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">mae_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">wind_test</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">krige_base</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">mae_stat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">wind_test</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">krige_stat</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">mae</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Empirical"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mae_emp</span><span class="op">)</span>,</span>
<span>    <span class="st">"Base"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mae_base</span><span class="op">)</span>,</span>
<span>    <span class="st">"STAT"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mae_stat</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">mae</span></span>
<span><span class="co">#&gt; Empirical      Base      STAT </span></span>
<span><span class="co">#&gt; 0.3776108 0.3890038 0.3851617</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="popi">POPI<a class="anchor" aria-label="anchor" href="#popi"></a>
</h4>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># POPI</span></span>
<span><span class="va">popi_emp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span></span>
<span>    <span class="va">wind_test</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;</span> <span class="va">krige_emp</span><span class="op">$</span><span class="va">lower</span> <span class="op">|</span> <span class="va">wind_test</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">krige_emp</span><span class="op">$</span><span class="va">upper</span>,</span>
<span>    na.rm <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span>
<span><span class="va">popi_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span></span>
<span>    <span class="va">wind_test</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;</span> <span class="va">krige_base</span><span class="op">$</span><span class="va">lower</span> <span class="op">|</span> <span class="va">wind_test</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">krige_base</span><span class="op">$</span><span class="va">upper</span>,</span>
<span>    na.rm <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span>
<span><span class="va">popi_stat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span></span>
<span>    <span class="va">wind_test</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;</span> <span class="va">krige_stat</span><span class="op">$</span><span class="va">lower</span> <span class="op">|</span> <span class="va">wind_test</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">krige_stat</span><span class="op">$</span><span class="va">upper</span>,</span>
<span>    na.rm <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span>
<span><span class="va">popi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Empirical"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">popi_emp</span><span class="op">)</span>,</span>
<span>    <span class="st">"Base"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">popi_base</span><span class="op">)</span>,</span>
<span>    <span class="st">"STAT"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">popi_stat</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">popi</span></span>
<span><span class="co">#&gt;  Empirical       Base       STAT </span></span>
<span><span class="co">#&gt; 0.06962321 0.06473026 0.06326550</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="simple-kriging-for-new-locations">Simple Kriging for new locations<a class="anchor" aria-label="anchor" href="#simple-kriging-for-new-locations"></a>
</h3>
<p>We provide functionalists for computing simple Kriging forecasts for
new locations. The associated function is <code>krige_new</code>, and
users can either supply the coordinates for the new locations or the
distance matrices for all locations. Hypotheticaly, suppose a new
location is at (<span class="math inline">\(9^\circ\)</span>W, <span class="math inline">\(52^\circ\)</span>N), then its kriging forecasts
along with forecasts for the rest of the stations for the general
stationary model can be obtained as follows.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">krige_stat_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/krige_new.html">krige_new</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">wind_mcgf</span>,</span>
<span>    newdata <span class="op">=</span> <span class="va">wind_test</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    locations_new <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">9</span>, <span class="fl">52</span><span class="op">)</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>    interval <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">krige_stat_new</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt;             VAL        BEL        CLA        SHA        ROC        BIR</span></span>
<span><span class="co">#&gt; 3653         NA         NA         NA         NA         NA         NA</span></span>
<span><span class="co">#&gt; 3654         NA         NA         NA         NA         NA         NA</span></span>
<span><span class="co">#&gt; 3655         NA         NA         NA         NA         NA         NA</span></span>
<span><span class="co">#&gt; 3656 -0.1447040 -0.3018214 -0.5758966 -0.4693314 -0.1046231 -0.5499500</span></span>
<span><span class="co">#&gt; 3657  0.5307650  0.1531176  0.2150980  0.3479844  0.4910715  0.3157901</span></span>
<span><span class="co">#&gt; 3658  0.1632995  0.1648983  0.1734723  0.1751080  0.1567910  0.3091076</span></span>
<span><span class="co">#&gt;             MUL        MAL        KIL        CLO        DUB      New_1</span></span>
<span><span class="co">#&gt; 3653         NA         NA         NA         NA         NA         NA</span></span>
<span><span class="co">#&gt; 3654         NA         NA         NA         NA         NA         NA</span></span>
<span><span class="co">#&gt; 3655         NA         NA         NA         NA         NA         NA</span></span>
<span><span class="co">#&gt; 3656 -0.5196208 -0.2799845 -0.4627520 -0.7397430 -0.4240240 -0.4152704</span></span>
<span><span class="co">#&gt; 3657  0.2576929  0.1404444  0.1013024  0.1157068  0.2114298  0.8410688</span></span>
<span><span class="co">#&gt; 3658  0.3274626  0.3504309  0.1426461  0.1006568  0.4521153  0.2792891</span></span></code></pre></div>
<p>Below is a time-series plot for the first 100 forecasts for
<code>New_1</code>:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/plot.ts.html" class="external-link">plot.ts</a></span><span class="op">(</span><span class="va">krige_stat_new</span><span class="op">$</span><span class="va">fit</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="fl">12</span><span class="op">]</span>, ylab <span class="op">=</span> <span class="st">"Wind Speed for New_1"</span><span class="op">)</span></span></code></pre></div>
<p><img src="mcgf_files/figure-html/krige_plot-1.png" width="576"></p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Gneiting2002" class="csl-entry">
Gneiting, Tilmann. 2002. <span>“Nonseparable, Stationary Covariance
Functions for Space–Time Data.”</span> <em>Journal of the American
Statistical Association</em> 97 (458): 590–600. <a href="https://doi.org/10.1198/016214502760047113" class="external-link">https://doi.org/10.1198/016214502760047113</a>.
</div>
<div id="ref-Gneiting2006a" class="csl-entry">
Gneiting, Tilmann, Marc G. Genton, and Peter Guttorp. 2006.
<span>“Geostatistical Space-Time Models, Stationarity, Separability and
Full Symmetry.”</span> Department of Statistics, University of
Washington; <a href="https://stat.uw.edu/sites/default/files/files/reports/2005/tr475.pdf" class="external-link uri">https://stat.uw.edu/sites/default/files/files/reports/2005/tr475.pdf</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tianxia Jia.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
