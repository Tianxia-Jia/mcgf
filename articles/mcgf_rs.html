<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mcgf">
<title>Steps for fitting an `mcgf_rs` object â€¢ mcgf</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Steps for fitting an `mcgf_rs` object">
<meta property="og:description" content="mcgf">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mcgf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/mcgf.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/mcgf_rs.html">Steps for fitting an `mcgf_rs` object</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tianxia-jia/mcgf/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Steps for fitting an `mcgf_rs` object</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tianxia-jia/mcgf/blob/HEAD/vignettes/mcgf_rs.Rmd" class="external-link"><code>vignettes/mcgf_rs.Rmd</code></a></small>
      <div class="d-none name"><code>mcgf_rs.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>mcgf</code> package contains useful functions to simulate
Markov chain Gaussian fields (MCGF) and regime-switching Markov chain
Gaussian fields (RS-MCGF) with covariance structures of the Gneiting
class <span class="citation">(Gneiting 2002)</span>. It also provides
useful tools to estimate the parameters by weighted least squares (WLS)
and maximum likelihood estimation (MLE). The <code>mcgf_rs</code>
function can used be to fit covariance models and obtain Kriging
forecasts. A typical workflow for fitting a regime-switching mcgf is
given below.</p>
<ol style="list-style-type: decimal">
<li>Create an <code>mcgf_rs</code> object by providing a dataset and the
corresponding locations/distances</li>
<li>Calculate auto- and cross-correlations.</li>
<li>Fit the base covariance model which is a fully symmetric model.</li>
<li>Fit the Lagrangian model to account for asymmetry, if
necessary.</li>
<li>Obtain Kriging forecasts.</li>
<li>Obtain Kriging forecasts for new locations given their
coordinates.</li>
</ol>
<p>We will demonstrate the use of <code>mcgf_rs</code> by an example
below.</p>
</div>
<div class="section level2">
<h2 id="simulated-example">Simulated Example<a class="anchor" aria-label="anchor" href="#simulated-example"></a>
</h2>
<p>Here we will generate a regime-switching MCGF process of size 5,000
with the general stationary covariance structure. More specifically, we
suppose there are two regimes each with different prevailing winds but
the same fully symmetric model. We will begin with simulating the regime
process first.</p>
<div class="section level3">
<h3 id="regime-process">Regime process<a class="anchor" aria-label="anchor" href="#regime-process"></a>
</h3>
<p>We start with simulating a transition matrix for a two-stage Markov
chain with high probabilities of staying in the current regime. The
simulated transition matrix and regime process is given below.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tianxia-jia/mcgf" class="external-link">mcgf</a></span><span class="op">)</span></span>
<span><span class="va">K</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">5000</span></span>
<span><span class="va">lag</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">tran_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">K</span><span class="op">^</span><span class="fl">2</span>, mean <span class="op">=</span> <span class="fl">0.06</span> <span class="op">/</span> <span class="op">(</span><span class="va">K</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">K</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">tran_mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">K</span>, mean <span class="op">=</span> <span class="fl">0.94</span>, sd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">tran_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sweep.html" class="external-link">sweep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">tran_mat</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">tran_mat</span><span class="op">)</span>, <span class="va">`/`</span><span class="op">)</span></span>
<span><span class="va">tran_mat</span></span>
<span><span class="co">#&gt;            [,1]       [,2]</span></span>
<span><span class="co">#&gt; [1,] 0.92650859 0.07349141</span></span>
<span><span class="co">#&gt; [2,] 0.04934827 0.95065173</span></span>
<span></span>
<span><span class="va">regime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">N</span><span class="op">)</span></span>
<span><span class="va">regime</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">regime</span><span class="op">[</span><span class="va">n</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">K</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">tran_mat</span><span class="op">[</span><span class="va">regime</span><span class="op">[</span><span class="va">n</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">regime</span><span class="op">)</span></span>
<span><span class="co">#&gt; regime</span></span>
<span><span class="co">#&gt;    1    2 </span></span>
<span><span class="co">#&gt; 1993 3007</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-simulation">Data Simulation<a class="anchor" aria-label="anchor" href="#data-simulation"></a>
</h3>
<div class="section level4">
<h4 id="locations">Locations<a class="anchor" aria-label="anchor" href="#locations"></a>
</h4>
<p>We generate the coordinates of 25 locations below and treat the last
5 locations as unobserved locations.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">25</span>, <span class="op">-</span><span class="fl">110</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">locations_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>lon <span class="op">=</span> <span class="va">x</span>, lat <span class="op">=</span> <span class="va">y</span><span class="op">)</span></span>
<span><span class="va">locations</span> <span class="op">&lt;-</span> <span class="va">locations_all</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="op">]</span></span>
<span><span class="va">locations_new</span> <span class="op">&lt;-</span> <span class="va">locations_all</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">locations_all</span></span>
<span><span class="co">#&gt;             lon      lat</span></span>
<span><span class="co">#&gt;  [1,] -110.5605 48.31331</span></span>
<span><span class="co">#&gt;  [2,] -110.2302 50.83779</span></span>
<span><span class="co">#&gt;  [3,] -108.4413 50.15337</span></span>
<span><span class="co">#&gt;  [4,] -109.9295 48.86186</span></span>
<span><span class="co">#&gt;  [5,] -109.8707 51.25381</span></span>
<span><span class="co">#&gt;  [6,] -108.2849 50.42646</span></span>
<span><span class="co">#&gt;  [7,] -109.5391 49.70493</span></span>
<span><span class="co">#&gt;  [8,] -111.2651 50.89513</span></span>
<span><span class="co">#&gt;  [9,] -110.6869 50.87813</span></span>
<span><span class="co">#&gt; [10,] -110.4457 50.82158</span></span>
<span><span class="co">#&gt; [11,] -108.7759 50.68864</span></span>
<span><span class="co">#&gt; [12,] -109.6402 50.55392</span></span>
<span><span class="co">#&gt; [13,] -109.5992 49.93809</span></span>
<span><span class="co">#&gt; [14,] -109.8893 49.69404</span></span>
<span><span class="co">#&gt; [15,] -110.5558 49.61953</span></span>
<span><span class="co">#&gt; [16,] -108.2131 49.30529</span></span>
<span><span class="co">#&gt; [17,] -109.5021 49.79208</span></span>
<span><span class="co">#&gt; [18,] -111.9666 48.73460</span></span>
<span><span class="co">#&gt; [19,] -109.2986 52.16896</span></span>
<span><span class="co">#&gt; [20,] -110.4728 51.20796</span></span>
<span><span class="co">#&gt; [21,] -111.0678 48.87689</span></span>
<span><span class="co">#&gt; [22,] -110.2180 49.59712</span></span>
<span><span class="co">#&gt; [23,] -111.0260 49.53334</span></span>
<span><span class="co">#&gt; [24,] -110.7289 50.77997</span></span>
<span><span class="co">#&gt; [25,] -110.6250 49.91663</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="data-simulation-1">Data simulation<a class="anchor" aria-label="anchor" href="#data-simulation-1"></a>
</h4>
<p>To simulate the 5-th order RS-MCGF process, we calculate the distance
matrices for all locations first and then use <code>mcgf_rs_sim</code>
to simulate such process.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># simulate RS MCGF</span></span>
<span><span class="va">par_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    par_s <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nugget <span class="op">=</span> <span class="fl">0</span>, c <span class="op">=</span> <span class="fl">0.005</span>, gamma <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    par_t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">par_lagr1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>v1 <span class="op">=</span> <span class="fl">100</span>, v2 <span class="op">=</span> <span class="fl">100</span>, k <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">par_lagr2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>v1 <span class="op">=</span> <span class="fl">50</span>, v2 <span class="op">=</span> <span class="fl">100</span>, k <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">h</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_dists_new.html">find_dists_new</a></span><span class="op">(</span><span class="va">locations</span>, <span class="va">locations_new</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">data_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcgf_rs_sim.html">mcgf_rs_sim</a></span><span class="op">(</span></span>
<span>    N <span class="op">=</span> <span class="va">N</span>, label <span class="op">=</span> <span class="va">regime</span>,</span>
<span>    base_ls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"sep"</span><span class="op">)</span>,</span>
<span>    lagrangian_ls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"lagr_tri"</span><span class="op">)</span>,</span>
<span>    par_base_ls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">par_base</span><span class="op">)</span>,</span>
<span>    par_lagr_ls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">par_lagr1</span>, <span class="va">par_lagr2</span><span class="op">)</span>,</span>
<span>    lambda_ls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.3</span><span class="op">)</span>,</span>
<span>    lag_ls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">lag</span>, <span class="va">lag</span><span class="op">)</span>,</span>
<span>    dists_ls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">h</span>, <span class="va">h</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">data_all</span> <span class="op">&lt;-</span> <span class="va">data_all</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">lag</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">data_all</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data_all</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_all</span><span class="op">)</span></span>
<span><span class="co">#&gt;   regime          1           2          3           4           5          6</span></span>
<span><span class="co">#&gt; 1      1 -0.4131534 -0.21405685  0.7229975 -0.08322733  0.07023563  1.1604699</span></span>
<span><span class="co">#&gt; 2      1 -1.7574429 -0.06411826  0.3964733 -1.75421279  0.80900801  0.9012895</span></span>
<span><span class="co">#&gt; 3      1 -0.8264216 -1.02490415 -0.4809606 -0.52653010 -0.49018553  0.4388830</span></span>
<span><span class="co">#&gt; 4      1  0.4089212 -0.72910670 -1.6972114 -0.01897436 -1.38506809 -1.1222586</span></span>
<span><span class="co">#&gt; 5      1 -0.4281591  0.03573133 -0.4868917 -0.58029926 -0.71498960 -0.5022470</span></span>
<span><span class="co">#&gt; 6      1 -0.9151832 -0.15757508  0.1973134 -1.31430392  0.24629283  0.9822986</span></span>
<span><span class="co">#&gt;            7          8           9           10         11         12</span></span>
<span><span class="co">#&gt; 1  0.3711177 -0.7330453 -0.63540128 -0.505026336  1.1774047  0.4296625</span></span>
<span><span class="co">#&gt; 2 -0.8354430 -0.2938705  0.03111661  0.085975510  1.1477487  0.4023173</span></span>
<span><span class="co">#&gt; 3 -1.6674136 -1.0990787 -1.00007998 -0.947069513  0.3588851 -0.8873257</span></span>
<span><span class="co">#&gt; 4 -0.9068406 -0.8932880 -0.58649863 -0.683863298 -0.9053647 -0.4603737</span></span>
<span><span class="co">#&gt; 5 -0.6486205 -0.9952912 -0.44048783 -0.006790727 -0.5014230  0.1964397</span></span>
<span><span class="co">#&gt; 6 -0.5239507 -0.6489432 -0.53016266 -0.683924188  1.2357249 -0.2040576</span></span>
<span><span class="co">#&gt;           13         14         15         16         17          18         19</span></span>
<span><span class="co">#&gt; 1  0.4330098  0.2688759 -0.2456852  1.1310980  0.5107434 -1.49171524  0.5461195</span></span>
<span><span class="co">#&gt; 2 -0.4543559 -0.9603846 -1.4064577 -0.4327531 -0.6527845 -2.36113493  2.0883711</span></span>
<span><span class="co">#&gt; 3 -1.4776433 -1.7967629 -1.9298573 -0.7471992 -1.4625251 -1.10579922  1.4295638</span></span>
<span><span class="co">#&gt; 4 -0.6764329 -0.9565217 -0.3102249 -0.1738450 -0.6722008 -0.01761965 -0.3733054</span></span>
<span><span class="co">#&gt; 5 -0.8742965 -0.6689574 -0.3878315  0.1411472 -0.6709104 -1.22389933 -0.7333397</span></span>
<span><span class="co">#&gt; 6 -0.4211337 -0.1178140 -1.2466737  0.1826659 -0.4473040 -2.16117290 -0.1881705</span></span>
<span><span class="co">#&gt;            20      New_1       New_2      New_3       New_4      New_5</span></span>
<span><span class="co">#&gt; 1 -0.44740467 -1.1643327 -0.06426498 -1.0297345 -0.77352947 -0.5462547</span></span>
<span><span class="co">#&gt; 2  0.79348781 -2.5153602 -1.36237046 -2.0750023 -0.01391596 -1.2526368</span></span>
<span><span class="co">#&gt; 3  0.01670341 -1.5287918 -2.41782779 -1.2808399 -1.23474600 -2.2184071</span></span>
<span><span class="co">#&gt; 4 -0.31026289 -0.3648568 -0.20992439  0.1999604 -0.81191510 -0.8132315</span></span>
<span><span class="co">#&gt; 5 -0.38518119 -0.9982079 -0.59390388 -0.8748418 -0.61917135 -0.1031998</span></span>
<span><span class="co">#&gt; 6 -0.48971901 -1.9617002 -1.33014481 -1.4159325 -0.20824058 -1.3501761</span></span></code></pre></div>
<p>We will holdout the new locations for parameter estimation.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_old</span> <span class="op">&lt;-</span> <span class="va">data_all</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">21</span><span class="op">]</span></span>
<span><span class="va">data_new</span> <span class="op">&lt;-</span> <span class="va">data_all</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">21</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="fitting-covariance-models">Fitting Covariance Models<a class="anchor" aria-label="anchor" href="#fitting-covariance-models"></a>
</h3>
<p>We will first fit pure spatial and temporal models, then the fully
symmetric model, and finally the general stationary model. First, we
will create an <code>mcgf_rs</code> object and calculate auto- and
cross- correlations.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_mcgf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcgf_rs.html">mcgf_rs</a></span><span class="op">(</span><span class="va">data_old</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    locations <span class="op">=</span> <span class="va">locations</span>, longlat <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    label <span class="op">=</span> <span class="va">data_old</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; `time` is not provided, assuming rows are equally spaced temporally.</span></span>
<span><span class="va">data_mcgf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/acfs.mcgf.html">add_acfs</a></span><span class="op">(</span><span class="va">data_mcgf</span>, lag_max <span class="op">=</span> <span class="va">lag</span><span class="op">)</span></span>
<span><span class="va">data_mcgf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ccfs.mcgf.html">add_ccfs</a></span><span class="op">(</span><span class="va">data_mcgf</span>, lag_max <span class="op">=</span> <span class="va">lag</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># If multiple cores are available</span></span>
<span><span class="co"># data_mcgf &lt;- add_ccfs(data_mcgf, lag_max = lag, ncores = 8)</span></span></code></pre></div>
<p>Here <code>acfs</code> actually refers to the mean auto-correlations
across the stations for each time lag. To view the calculated
<code>acfs</code>, we can run:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/acfs.html">acfs</a></span><span class="op">(</span><span class="va">data_mcgf</span><span class="op">)</span></span>
<span><span class="co">#&gt; $acfs</span></span>
<span><span class="co">#&gt;      lag0      lag1      lag2      lag3      lag4      lag5 </span></span>
<span><span class="co">#&gt; 1.0000000 0.6075506 0.4076272 0.3805953 0.3702800 0.3586723 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $acfs_rs</span></span>
<span><span class="co">#&gt; $acfs_rs$`Regime 1`</span></span>
<span><span class="co">#&gt;      lag0      lag1      lag2      lag3      lag4      lag5 </span></span>
<span><span class="co">#&gt; 1.0000000 0.5953378 0.3991894 0.3814418 0.3714696 0.3639292 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $acfs_rs$`Regime 2`</span></span>
<span><span class="co">#&gt;      lag0      lag1      lag2      lag3      lag4      lag5 </span></span>
<span><span class="co">#&gt; 1.0000000 0.6149751 0.4125410 0.3797082 0.3691936 0.3550066</span></span></code></pre></div>
<p>Similarly, we can view the <code>ccfs</code> by the <code>ccfs</code>
function. Here we will present lag 1 regime-switching ccfs for the first
6 locations for the two regimes.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Regime 1</span></span>
<span><span class="fu"><a href="../reference/ccfs.html">ccfs</a></span><span class="op">(</span><span class="va">data_mcgf</span><span class="op">)</span><span class="op">$</span><span class="va">ccfs_rs</span><span class="op">$</span><span class="va">`Regime 1`</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="fl">2</span><span class="op">]</span></span>
<span><span class="co">#&gt;           1         2          3         4         5          6</span></span>
<span><span class="co">#&gt; 1 0.6047946 0.1236369 0.05451172 0.3713023 0.1363766 0.07120106</span></span>
<span><span class="co">#&gt; 2 0.3027375 0.6174314 0.25427725 0.4220703 0.4477891 0.23134358</span></span>
<span><span class="co">#&gt; 3 0.2293202 0.3347340 0.58222643 0.3837498 0.2952973 0.46537082</span></span>
<span><span class="co">#&gt; 4 0.5256692 0.1564803 0.12938351 0.6003370 0.1701296 0.11145141</span></span>
<span><span class="co">#&gt; 5 0.2602507 0.5444454 0.32282783 0.3751226 0.6132754 0.30494395</span></span>
<span><span class="co">#&gt; 6 0.1959693 0.3710529 0.53421219 0.3193299 0.3348082 0.56379838</span></span>
<span></span>
<span><span class="co"># Regime 2</span></span>
<span><span class="fu"><a href="../reference/ccfs.html">ccfs</a></span><span class="op">(</span><span class="va">data_mcgf</span><span class="op">)</span><span class="op">$</span><span class="va">ccfs_rs</span><span class="op">$</span><span class="va">`Regime 2`</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="fl">2</span><span class="op">]</span></span>
<span><span class="co">#&gt;           1         2         3         4         5         6</span></span>
<span><span class="co">#&gt; 1 0.6172964 0.1575309 0.1723283 0.3893590 0.1096808 0.1688383</span></span>
<span><span class="co">#&gt; 2 0.2620954 0.6289374 0.3280881 0.3878912 0.4234188 0.3004865</span></span>
<span><span class="co">#&gt; 3 0.2811509 0.3158273 0.6163612 0.4355238 0.2379046 0.4932367</span></span>
<span><span class="co">#&gt; 4 0.5759686 0.1825519 0.2120796 0.6293679 0.1514506 0.1733759</span></span>
<span><span class="co">#&gt; 5 0.1509059 0.5799483 0.4202242 0.2930347 0.6249524 0.4089683</span></span>
<span><span class="co">#&gt; 6 0.2351466 0.3713949 0.5875119 0.3502719 0.3122138 0.6069874</span></span></code></pre></div>
<div class="section level4">
<h4 id="pure-spatial-model">Pure Spatial Model<a class="anchor" aria-label="anchor" href="#pure-spatial-model"></a>
</h4>
<p>The pure spatial model can be fitted using the <code>fit_base</code>
function. The results are actually obtained from the optimization
function <code>nlminb</code>. Since the base model is the same for the
two regimes, we set <code>rs = FALSE</code> to indicate this.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_spatial</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_base.html">fit_base</a></span><span class="op">(</span></span>
<span>    <span class="va">data_mcgf</span>,</span>
<span>    model_ls <span class="op">=</span> <span class="st">"spatial"</span>,</span>
<span>    lag_ls <span class="op">=</span> <span class="va">lag</span>,</span>
<span>    par_init_ls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>c <span class="op">=</span> <span class="fl">0.000001</span>, gamma <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    par_fixed_ls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>nugget <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    rs <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fit_spatial</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">fit</span></span>
<span><span class="co">#&gt; $par</span></span>
<span><span class="co">#&gt;          c      gamma </span></span>
<span><span class="co">#&gt; 0.00390725 0.50000000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $objective</span></span>
<span><span class="co">#&gt; [1] 13.20815</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $convergence</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $iterations</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $evaluations</span></span>
<span><span class="co">#&gt; function gradient </span></span>
<span><span class="co">#&gt;       11        7 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; [1] "both X-convergence and relative convergence (5)"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="pure-temporal-model">Pure Temporal Model<a class="anchor" aria-label="anchor" href="#pure-temporal-model"></a>
</h4>
<p>The pure temporal can also be fitted by <code>fit_base</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_temporal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_base.html">fit_base</a></span><span class="op">(</span></span>
<span>    <span class="va">data_mcgf</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"temporal"</span>,</span>
<span>    lag_ls <span class="op">=</span> <span class="va">lag</span>,</span>
<span>    par_init_ls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    rs <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fit_temporal</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">fit</span></span>
<span><span class="co">#&gt; $par</span></span>
<span><span class="co">#&gt;         a     alpha </span></span>
<span><span class="co">#&gt; 0.7137588 0.3484975 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $objective</span></span>
<span><span class="co">#&gt; [1] 0.0202941</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $convergence</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $iterations</span></span>
<span><span class="co">#&gt; [1] 9</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $evaluations</span></span>
<span><span class="co">#&gt; function gradient </span></span>
<span><span class="co">#&gt;       11       26 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; [1] "relative convergence (4)"</span></span></code></pre></div>
<p>We can store the fitted spatial and temporal models to
<code>data_mcgf</code> using <code>add_base</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_mcgf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_base.html">add_base</a></span><span class="op">(</span><span class="va">data_mcgf</span>,</span>
<span>    fit_s <span class="op">=</span> <span class="va">fit_spatial</span>,</span>
<span>    fit_t <span class="op">=</span> <span class="va">fit_temporal</span>,</span>
<span>    sep <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="separable-model">Separable Model<a class="anchor" aria-label="anchor" href="#separable-model"></a>
</h4>
<p>We can also calculate the WLS estimates all at once by fitting the
separable model:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_sep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_base.html">fit_base</a></span><span class="op">(</span></span>
<span>    <span class="va">data_mcgf</span>,</span>
<span>    model_ls <span class="op">=</span> <span class="st">"sep"</span>,</span>
<span>    lag_ls <span class="op">=</span> <span class="va">lag</span>,</span>
<span>    par_init_ls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>c <span class="op">=</span> <span class="fl">0.000001</span>, gamma <span class="op">=</span> <span class="fl">0.5</span>, a <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    par_fixed_ls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>nugget <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>iter.max <span class="op">=</span> <span class="fl">10000</span>, eval.max <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    rs <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fit_sep</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">fit</span></span>
<span><span class="co">#&gt; $par</span></span>
<span><span class="co">#&gt;          c      gamma          a      alpha </span></span>
<span><span class="co">#&gt; 0.00390725 0.50000000 0.72365072 0.39736171 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $objective</span></span>
<span><span class="co">#&gt; [1] 29.16779</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $convergence</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $iterations</span></span>
<span><span class="co">#&gt; [1] 11</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $evaluations</span></span>
<span><span class="co">#&gt; function gradient </span></span>
<span><span class="co">#&gt;       27       64 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; [1] "relative convergence (4)"</span></span></code></pre></div>
<p>store the fully symmetric model as the base model and print the base
model:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_mcgf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_base.html">add_base</a></span><span class="op">(</span><span class="va">data_mcgf</span>, fit_base <span class="op">=</span> <span class="va">fit_sep</span>, old <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/model.html">model</a></span><span class="op">(</span><span class="va">data_mcgf</span>, model <span class="op">=</span> <span class="st">"base"</span>, old <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt;                  Model</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt; - Time lag: 5 </span></span>
<span><span class="co">#&gt; - Scale of time lag: 1 </span></span>
<span><span class="co">#&gt; - Forecast horizon: 1 </span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt;             Old - not in use</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt; - Regime switching: FALSE</span></span>
<span><span class="co">#&gt; - Base model: sep </span></span>
<span><span class="co">#&gt; - Parameters:</span></span>
<span><span class="co">#&gt;          c      gamma     nugget          a      alpha </span></span>
<span><span class="co">#&gt; 0.00390725 0.50000000 0.00000000 0.71375884 0.34849745 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Fixed parameters:</span></span>
<span><span class="co">#&gt; nugget </span></span>
<span><span class="co">#&gt;      0 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Parameter estimation method: wls wls </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Optimization function: nlminb nlminb </span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt;                  Base</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt; - Regime switching: FALSE</span></span>
<span><span class="co">#&gt; - Base model: sep </span></span>
<span><span class="co">#&gt; - Parameters:</span></span>
<span><span class="co">#&gt;          c      gamma          a      alpha     nugget </span></span>
<span><span class="co">#&gt; 0.00390725 0.50000000 0.72365072 0.39736171 0.00000000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Fixed parameters:</span></span>
<span><span class="co">#&gt; nugget </span></span>
<span><span class="co">#&gt;      0 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Parameter estimation method: wls </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Optimization function: nlminb</span></span></code></pre></div>
<p>The <code>old = TRUE</code> in <code>add_base</code> keeps the fitted
pure spatial and temporal models for records, and they are not used for
any further steps. It is recommended to keep the old model not only for
reproducibility, but to keep a history of fitted models.</p>
</div>
<div class="section level4">
<h4 id="lagrangian-model">Lagrangian Model<a class="anchor" aria-label="anchor" href="#lagrangian-model"></a>
</h4>
<p>We will fit Lagrangian correlation functions to model the
regime-dependent prevailing winds:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_lagr_rs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_lagr.html">fit_lagr</a></span><span class="op">(</span><span class="va">data_mcgf</span>,</span>
<span>    model_ls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"lagr_tri"</span><span class="op">)</span>,</span>
<span>    par_init_ls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="fl">0.1</span>, v1 <span class="op">=</span> <span class="fl">100</span>, v2 <span class="op">=</span> <span class="fl">100</span>, k <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">fit_lagr_rs</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`Regime 1`</span></span>
<span><span class="co">#&gt; $`Regime 1`$par</span></span>
<span><span class="co">#&gt;     lambda         v1         v2          k </span></span>
<span><span class="co">#&gt;  0.1703142 74.4859663 65.8446145  1.3401565 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Regime 1`$objective</span></span>
<span><span class="co">#&gt; [1] 12.76542</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Regime 1`$convergence</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Regime 1`$iterations</span></span>
<span><span class="co">#&gt; [1] 31</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Regime 1`$evaluations</span></span>
<span><span class="co">#&gt; function gradient </span></span>
<span><span class="co">#&gt;       38      147 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Regime 1`$message</span></span>
<span><span class="co">#&gt; [1] "relative convergence (4)"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Regime 2`</span></span>
<span><span class="co">#&gt; $`Regime 2`$par</span></span>
<span><span class="co">#&gt;     lambda         v1         v2          k </span></span>
<span><span class="co">#&gt;  0.2167212 43.9009790 78.2938279  1.7852123 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Regime 2`$objective</span></span>
<span><span class="co">#&gt; [1] 15.68579</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Regime 2`$convergence</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Regime 2`$iterations</span></span>
<span><span class="co">#&gt; [1] 27</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Regime 2`$evaluations</span></span>
<span><span class="co">#&gt; function gradient </span></span>
<span><span class="co">#&gt;       35      128 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Regime 2`$message</span></span>
<span><span class="co">#&gt; [1] "relative convergence (4)"</span></span></code></pre></div>
<p>Finally we will store this model to <code>data_mcgf</code> using
<code>add_lagr</code> and then print the final model:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_mcgf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_lagr.html">add_lagr</a></span><span class="op">(</span><span class="va">data_mcgf</span>, fit_lagr <span class="op">=</span> <span class="va">fit_lagr_rs</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/model.html">model</a></span><span class="op">(</span><span class="va">data_mcgf</span>, old <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt;                  Model</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt; - Time lag: 5, 5 </span></span>
<span><span class="co">#&gt; - Scale of time lag: 1 </span></span>
<span><span class="co">#&gt; - Forecast horizon: 1 </span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt;             Old - not in use</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt; - Regime switching: FALSE</span></span>
<span><span class="co">#&gt; - Base model: sep </span></span>
<span><span class="co">#&gt; - Parameters:</span></span>
<span><span class="co">#&gt;          c      gamma     nugget          a      alpha </span></span>
<span><span class="co">#&gt; 0.00390725 0.50000000 0.00000000 0.71375884 0.34849745 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Fixed parameters:</span></span>
<span><span class="co">#&gt; nugget </span></span>
<span><span class="co">#&gt;      0 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Parameter estimation method: wls wls </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Optimization function: nlminb nlminb </span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt;                  Base</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt; - Regime switching: FALSE</span></span>
<span><span class="co">#&gt; - Base model: sep </span></span>
<span><span class="co">#&gt; - Parameters:</span></span>
<span><span class="co">#&gt;          c      gamma          a      alpha     nugget </span></span>
<span><span class="co">#&gt; 0.00390725 0.50000000 0.72365072 0.39736171 0.00000000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Fixed parameters:</span></span>
<span><span class="co">#&gt; nugget </span></span>
<span><span class="co">#&gt;      0 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Parameter estimation method: wls </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Optimization function: nlminb </span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt;               Lagrangian</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt; - Regime switching: TRUE </span></span>
<span><span class="co">#&gt; --------------------</span></span>
<span><span class="co">#&gt;       Regime 1 </span></span>
<span><span class="co">#&gt; --------------------</span></span>
<span><span class="co">#&gt; - Lagrangian model: lagr_tri </span></span>
<span><span class="co">#&gt; - Parameters:</span></span>
<span><span class="co">#&gt;     lambda         v1         v2          k </span></span>
<span><span class="co">#&gt;  0.1703142 74.4859663 65.8446145  1.3401565 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Fixed parameters:</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Parameter estimation method: wls </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Optimization function: nlminb </span></span>
<span><span class="co">#&gt; --------------------</span></span>
<span><span class="co">#&gt;       Regime 2 </span></span>
<span><span class="co">#&gt; --------------------</span></span>
<span><span class="co">#&gt; - Lagrangian model: lagr_tri </span></span>
<span><span class="co">#&gt; - Parameters:</span></span>
<span><span class="co">#&gt;     lambda         v1         v2          k </span></span>
<span><span class="co">#&gt;  0.2167212 43.9009790 78.2938279  1.7852123 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Fixed parameters:</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Parameter estimation method: wls </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Optimization function: nlminb</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="simple-kriging-for-new-locations">Simple Kriging for new locations<a class="anchor" aria-label="anchor" href="#simple-kriging-for-new-locations"></a>
</h3>
<p>We provide functionalists for computing simple Kriging forecasts for
new locations. The associated function is <code>krige_new</code>, and
users can either supply the coordinates for the new locations or the
distance matrices for all locations.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">krige_base_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/krige_new.html">krige_new</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">data_mcgf</span>,</span>
<span>    locations_new <span class="op">=</span> <span class="va">locations_new</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"base"</span>,</span>
<span>    interval <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">krige_stat_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/krige_new.html">krige_new</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">data_mcgf</span>,</span>
<span>    locations_new <span class="op">=</span> <span class="va">locations_new</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>    interval <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Next, we can compute the root mean square error (RMSE), mean absolute
error (MAE), and the realized percentage of observations falling outside
the 95% PI (POPI) for these models for the new locations.</p>
<div class="section level4">
<h4 id="rmse">RMSE<a class="anchor" aria-label="anchor" href="#rmse"></a>
</h4>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># RMSE</span></span>
<span><span class="va">rmse_base</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="op">(</span><span class="va">data_new</span> <span class="op">-</span> <span class="va">krige_base_new</span><span class="op">$</span><span class="va">fit</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rmse_stat</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="op">(</span><span class="va">data_new</span> <span class="op">-</span> <span class="va">krige_stat_new</span><span class="op">$</span><span class="va">fit</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rmse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Base"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rmse_base</span><span class="op">)</span>,</span>
<span>    <span class="st">"STAT"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rmse_stat</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">rmse</span></span>
<span><span class="co">#&gt;      Base      STAT </span></span>
<span><span class="co">#&gt; 0.8117693 0.7621844</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="mae">MAE<a class="anchor" aria-label="anchor" href="#mae"></a>
</h4>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mae_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">data_new</span> <span class="op">-</span> <span class="va">krige_base_new</span><span class="op">$</span><span class="va">fit</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">mae_stat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">data_new</span> <span class="op">-</span> <span class="va">krige_stat_new</span><span class="op">$</span><span class="va">fit</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">mae</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Base"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mae_base</span><span class="op">)</span>,</span>
<span>    <span class="st">"STAT"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mae_stat</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">mae</span></span>
<span><span class="co">#&gt;      Base      STAT </span></span>
<span><span class="co">#&gt; 0.6451738 0.6060982</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="popi">POPI<a class="anchor" aria-label="anchor" href="#popi"></a>
</h4>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># POPI</span></span>
<span><span class="va">popi_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span></span>
<span>    <span class="va">data_new</span> <span class="op">&lt;</span> <span class="va">krige_base_new</span><span class="op">$</span><span class="va">lower</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span><span class="op">]</span> <span class="op">|</span> <span class="va">data_new</span> <span class="op">&gt;</span> <span class="va">krige_base_new</span><span class="op">$</span><span class="va">upper</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    na.rm <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span>
<span><span class="va">popi_stat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span></span>
<span>    <span class="va">data_new</span> <span class="op">&lt;</span> <span class="va">krige_stat_new</span><span class="op">$</span><span class="va">lower</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span><span class="op">]</span> <span class="op">|</span> <span class="va">data_new</span> <span class="op">&gt;</span> <span class="va">krige_stat_new</span><span class="op">$</span><span class="va">upper</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    na.rm <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span>
<span><span class="va">popi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Base"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">popi_base</span><span class="op">)</span>,</span>
<span>    <span class="st">"STAT"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">popi_stat</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">popi</span></span>
<span><span class="co">#&gt;       Base       STAT </span></span>
<span><span class="co">#&gt; 0.04560561 0.03811812</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Gneiting2002" class="csl-entry">
Gneiting, Tilmann. 2002. <span>â€œNonseparable, Stationary Covariance
Functions for Spaceâ€“Time Data.â€</span> <em>Journal of the American
Statistical Association</em> 97 (458): 590â€“600. <a href="https://doi.org/10.1198/016214502760047113" class="external-link">https://doi.org/10.1198/016214502760047113</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Tianxia Jia.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
