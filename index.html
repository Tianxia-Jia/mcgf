<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Simulating and estimating (regime-switching) Markov chain Gaussian 
    fields with covariance functions of the Gneiting class. It supports 
    parameter estimation by weighted least squares and maximum likelihood 
    methods, and produces Kriging forecasts and intervals (Cressie 1993) 
    &lt;doi:10.1002/9781119115151&gt;.">
<title>Markov Chain Gaussian Fields Simulation and Parameter 
    Estimation â€¢ mcgf</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Markov Chain Gaussian Fields Simulation and Parameter 
    Estimation">
<meta property="og:description" content="Simulating and estimating (regime-switching) Markov chain Gaussian 
    fields with covariance functions of the Gneiting class. It supports 
    parameter estimation by weighted least squares and maximum likelihood 
    methods, and produces Kriging forecasts and intervals (Cressie 1993) 
    &lt;doi:10.1002/9781119115151&gt;.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">mcgf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="articles/mcgf.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tianxia-jia/mcgf/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="mcgf">mcgf<a class="anchor" aria-label="anchor" href="#mcgf"></a>
</h1></div>
<!-- badges: start -->

<p>The goal of <code>mcgf</code> is to provide easy-to-use functions for simulating and fitting covariance models. It provides functions for simulating (regime-switching) Markov chain Gaussian fields with covariance functions of the Gneiting class by simple kriging. Parameter estimation methods such as weighted least squares and maximum likelihood estimation are available. Below is an example of simulating and estimation parameters for an MCGF.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of mcgf from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"tianxia-jia/mcgf"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-simulation">Data Simulation<a class="anchor" aria-label="anchor" href="#data-simulation"></a>
</h2>
<p>To simulate an MCGF with fully symmetric covariance structure, we begin with simulating 10 locations randomly.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tianxia-jia/mcgf" class="external-link">mcgf</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">h</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/rdists.html">rdists</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p>Next, we simulate an MCGF with the general stationary covariance structure. In this example the covariance structure is a convex combination of a base separable model and a Lagrangian model account for asymmetry.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">lag</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="va">par_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    par_s <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nugget <span class="op">=</span> <span class="fl">0</span>, c <span class="op">=</span> <span class="fl">0.001</span>, gamma <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    par_t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">par_lagr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>v1 <span class="op">=</span> <span class="fl">200</span>, v2 <span class="op">=</span> <span class="fl">200</span>, k <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/mcgf_sim.html">mcgf_sim</a></span><span class="op">(</span></span>
<span>    N <span class="op">=</span> <span class="va">N</span>,</span>
<span>    base <span class="op">=</span> <span class="st">"sep"</span>,</span>
<span>    lagrangian <span class="op">=</span> <span class="st">"lagr_tri"</span>,</span>
<span>    par_base <span class="op">=</span> <span class="va">par_base</span>,</span>
<span>    par_lagr <span class="op">=</span> <span class="va">par_lagr</span>,</span>
<span>    lambda <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>    dists <span class="op">=</span> <span class="va">h</span>,</span>
<span>    lag <span class="op">=</span> <span class="va">lag</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sim1</span> <span class="op">&lt;-</span> <span class="va">sim1</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">lag</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">sim1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sim1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">sim1</span>, dists <span class="op">=</span> <span class="va">h</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="parameter-estimation">Parameter Estimation<a class="anchor" aria-label="anchor" href="#parameter-estimation"></a>
</h2>
<div class="section level3">
<h3 id="create-an-mcgf-object">Create an <code>mcgf</code> object<a class="anchor" aria-label="anchor" href="#create-an-mcgf-object"></a>
</h3>
<p>To estimate parameters, we need to calculate auto-correlations and cross-correlations. Letâ€™s first create an <code>mcgf</code> object. The <code>mcgf</code> class extends the <code>data.frame</code> with more attributes.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim1_mcgf</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/mcgf.html">mcgf</a></span><span class="op">(</span><span class="va">sim1</span><span class="op">$</span><span class="va">data</span>, dists <span class="op">=</span> <span class="va">sim1</span><span class="op">$</span><span class="va">dists</span><span class="op">)</span></span>
<span><span class="co">#&gt; `time` is not provided, assuming rows are equally spaced temporally.</span></span></code></pre></div>
<p>Then the acfs and ccfs can be added to this object as follows.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim1_mcgf</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/acfs.mcgf.html">add_acfs</a></span><span class="op">(</span><span class="va">sim1_mcgf</span>, lag_max <span class="op">=</span> <span class="va">lag</span><span class="op">)</span></span>
<span><span class="va">sim1_mcgf</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ccfs.mcgf.html">add_ccfs</a></span><span class="op">(</span><span class="va">sim1_mcgf</span>, lag_max <span class="op">=</span> <span class="va">lag</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="estimate-base-model">Estimate base model<a class="anchor" aria-label="anchor" href="#estimate-base-model"></a>
</h3>
<p>To perform parameter estimation, we can start with estimating the parameters for spatial and temporal models.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_spatial</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fit_base.html">fit_base</a></span><span class="op">(</span></span>
<span>    <span class="va">sim1_mcgf</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"spatial"</span>,</span>
<span>    lag <span class="op">=</span> <span class="va">lag</span>,</span>
<span>    par_init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>c <span class="op">=</span> <span class="fl">0.001</span>, gamma <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    par_fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>nugget <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fit_spatial</span><span class="op">$</span><span class="va">fit</span></span>
<span><span class="co">#&gt; $par</span></span>
<span><span class="co">#&gt;           c       gamma </span></span>
<span><span class="co">#&gt; 0.001160802 0.500000000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $objective</span></span>
<span><span class="co">#&gt; [1] 1.640593</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $convergence</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $iterations</span></span>
<span><span class="co">#&gt; [1] 8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $evaluations</span></span>
<span><span class="co">#&gt; function gradient </span></span>
<span><span class="co">#&gt;       21       20 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; [1] "both X-convergence and relative convergence (5)"</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_temporal</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fit_base.html">fit_base</a></span><span class="op">(</span></span>
<span>    <span class="va">sim1_mcgf</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"temporal"</span>,</span>
<span>    lag <span class="op">=</span> <span class="va">lag</span>,</span>
<span>    par_init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0.3</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fit_temporal</span><span class="op">$</span><span class="va">fit</span></span>
<span><span class="co">#&gt; $par</span></span>
<span><span class="co">#&gt;         a     alpha </span></span>
<span><span class="co">#&gt; 0.6528906 0.7560970 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $objective</span></span>
<span><span class="co">#&gt; [1] 0.004306706</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $convergence</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $iterations</span></span>
<span><span class="co">#&gt; [1] 18</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $evaluations</span></span>
<span><span class="co">#&gt; function gradient </span></span>
<span><span class="co">#&gt;       23       43 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; [1] "relative convergence (4)"</span></span></code></pre></div>
<p>Alternatively, we can fit the separable model all at once:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_sep</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fit_base.html">fit_base</a></span><span class="op">(</span></span>
<span>    <span class="va">sim1_mcgf</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"sep"</span>,</span>
<span>    lag <span class="op">=</span> <span class="va">lag</span>,</span>
<span>    par_init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        c <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>        gamma <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>        a <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>        alpha <span class="op">=</span> <span class="fl">0.5</span></span>
<span>    <span class="op">)</span>,</span>
<span>    par_fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>nugget <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fit_sep</span><span class="op">$</span><span class="va">fit</span></span>
<span><span class="co">#&gt; $par</span></span>
<span><span class="co">#&gt;           c       gamma           a       alpha </span></span>
<span><span class="co">#&gt; 0.001154864 0.500000000 0.624551338 0.735490605 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $objective</span></span>
<span><span class="co">#&gt; [1] 3.488305</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $convergence</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $iterations</span></span>
<span><span class="co">#&gt; [1] 18</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $evaluations</span></span>
<span><span class="co">#&gt; function gradient </span></span>
<span><span class="co">#&gt;       49       88 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; [1] "relative convergence (4)"</span></span></code></pre></div>
<p>we can also estimate the parameters using MLE:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_sep2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fit_base.html">fit_base</a></span><span class="op">(</span></span>
<span>    <span class="va">sim1_mcgf</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"sep"</span>,</span>
<span>    lag <span class="op">=</span> <span class="va">lag</span>,</span>
<span>    par_init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        c <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>        gamma <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>        a <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>        alpha <span class="op">=</span> <span class="fl">0.5</span></span>
<span>    <span class="op">)</span>,</span>
<span>    par_fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>nugget <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"mle"</span>,</span>
<span><span class="op">)</span></span>
<span><span class="va">fit_sep2</span><span class="op">$</span><span class="va">fit</span></span>
<span><span class="co">#&gt; $par</span></span>
<span><span class="co">#&gt;           c       gamma           a       alpha </span></span>
<span><span class="co">#&gt; 0.001197799 0.500000000 0.804621207 1.000000000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $objective</span></span>
<span><span class="co">#&gt; [1] -11520.04</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $convergence</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $iterations</span></span>
<span><span class="co">#&gt; [1] 17</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $evaluations</span></span>
<span><span class="co">#&gt; function gradient </span></span>
<span><span class="co">#&gt;       55       78 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; [1] "relative convergence (4)"</span></span></code></pre></div>
<p>Now we will add the base model to <code>x_mcgf</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim1_mcgf</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/add_base.html">add_base</a></span><span class="op">(</span><span class="va">sim1_mcgf</span>, fit_base <span class="op">=</span> <span class="va">fit_sep</span><span class="op">)</span></span></code></pre></div>
<p>To print the current model, we do</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/model.html">model</a></span><span class="op">(</span><span class="va">sim1_mcgf</span><span class="op">)</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt;                  Model</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt; - Time lag: 5 </span></span>
<span><span class="co">#&gt; - Scale of time lag: 1 </span></span>
<span><span class="co">#&gt; - Forecast horizon: 1 </span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt;                  Base</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt; - Base model: sep </span></span>
<span><span class="co">#&gt; - Parameters:</span></span>
<span><span class="co">#&gt;           c       gamma           a       alpha      nugget </span></span>
<span><span class="co">#&gt; 0.001154864 0.500000000 0.624551338 0.735490605 0.000000000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Fixed parameters:</span></span>
<span><span class="co">#&gt; nugget </span></span>
<span><span class="co">#&gt;      0 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Parameter estimation method: wls </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Optimization function: nlminb </span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt;               Lagrangian</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt; - Lagrangian model: </span></span>
<span><span class="co">#&gt; - Parameters:</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Fixed parameters:</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Parameter estimation method: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Optimization function:</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="estimate-the-lagrangian-model">Estimate the Lagrangian model<a class="anchor" aria-label="anchor" href="#estimate-the-lagrangian-model"></a>
</h3>
<p>Similarly, we can estimate the parameters for the Lagrangian component by</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_lagr</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fit_lagr.html">fit_lagr</a></span><span class="op">(</span></span>
<span>    <span class="va">sim1_mcgf</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"lagr_tri"</span>,</span>
<span>    par_init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>v1 <span class="op">=</span> <span class="fl">300</span>, v2 <span class="op">=</span> <span class="fl">300</span>, lambda <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span>,</span>
<span>    par_fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fit_lagr</span><span class="op">$</span><span class="va">fit</span></span>
<span><span class="co">#&gt; $par</span></span>
<span><span class="co">#&gt;      lambda          v1          v2 </span></span>
<span><span class="co">#&gt;   0.1757035 232.0852117 203.8869305 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $objective</span></span>
<span><span class="co">#&gt; [1] 1.627017</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $convergence</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $iterations</span></span>
<span><span class="co">#&gt; [1] 32</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $evaluations</span></span>
<span><span class="co">#&gt; function gradient </span></span>
<span><span class="co">#&gt;       35      126 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; [1] "relative convergence (4)"</span></span></code></pre></div>
<p>We can add the Lagrangian model by</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim1_mcgf</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/add_lagr.html">add_lagr</a></span><span class="op">(</span><span class="va">sim1_mcgf</span>, fit_lagr <span class="op">=</span> <span class="va">fit_lagr</span><span class="op">)</span></span></code></pre></div>
<p>Finally we may print the final model:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/model.html">model</a></span><span class="op">(</span><span class="va">sim1_mcgf</span><span class="op">)</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt;                  Model</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt; - Time lag: 5 </span></span>
<span><span class="co">#&gt; - Scale of time lag: 1 </span></span>
<span><span class="co">#&gt; - Forecast horizon: 1 </span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt;                  Base</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt; - Base model: sep </span></span>
<span><span class="co">#&gt; - Parameters:</span></span>
<span><span class="co">#&gt;           c       gamma           a       alpha      nugget </span></span>
<span><span class="co">#&gt; 0.001154864 0.500000000 0.624551338 0.735490605 0.000000000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Fixed parameters:</span></span>
<span><span class="co">#&gt; nugget </span></span>
<span><span class="co">#&gt;      0 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Parameter estimation method: wls </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Optimization function: nlminb </span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt;               Lagrangian</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt; - Lagrangian model: lagr_tri </span></span>
<span><span class="co">#&gt; - Parameters:</span></span>
<span><span class="co">#&gt;      lambda          v1          v2           k </span></span>
<span><span class="co">#&gt;   0.1757035 232.0852117 203.8869305   2.0000000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Fixed parameters:</span></span>
<span><span class="co">#&gt; k </span></span>
<span><span class="co">#&gt; 2 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Parameter estimation method: wls </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Optimization function: nlminb</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="kriging-forecast">Kriging forecast<a class="anchor" aria-label="anchor" href="#kriging-forecast"></a>
</h3>
<p>This package provides kriging forecasts (and intervals) for empirical, base, and general stationary models.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Empirical model</span></span>
<span><span class="va">fit_emp</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="reference/krige.html">krige</a></span><span class="op">(</span><span class="va">sim1_mcgf</span>,</span>
<span>        model <span class="op">=</span> <span class="st">"empirical"</span>,</span>
<span>        interval <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span><span class="va">rmse_emp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="op">(</span><span class="va">sim1_mcgf</span> <span class="op">-</span> <span class="va">fit_emp</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Base separable model</span></span>
<span><span class="va">fit_base</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="reference/krige.html">krige</a></span><span class="op">(</span><span class="va">sim1_mcgf</span>,</span>
<span>        model <span class="op">=</span> <span class="st">"base"</span>,</span>
<span>        interval <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span><span class="va">rmse_base</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="op">(</span><span class="va">sim1_mcgf</span> <span class="op">-</span> <span class="va">fit_base</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Stationary model</span></span>
<span><span class="va">fit_stat</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="reference/krige.html">krige</a></span><span class="op">(</span><span class="va">sim1_mcgf</span>,</span>
<span>        model <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>        interval <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span><span class="va">rmse_stat</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="op">(</span><span class="va">sim1_mcgf</span> <span class="op">-</span> <span class="va">fit_stat</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rmse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">rmse_emp</span>, <span class="va">rmse_base</span>, <span class="va">rmse_stat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">rmse</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Empirical"</span>, <span class="st">"Separable"</span>, <span class="st">"Stationary"</span><span class="op">)</span></span>
<span><span class="va">rmse</span></span>
<span><span class="co">#&gt;  Empirical  Separable Stationary </span></span>
<span><span class="co">#&gt;  0.7212175  0.7685016  0.7355458</span></span></code></pre></div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=mcgf" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/tianxia-jia/mcgf/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/tianxia-jia/mcgf/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing mcgf</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Tianxia Jia <br><small class="roles"> Author, maintainer, copyright holder </small> <a href="https://orcid.org/0000-0001-5430-5019" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/tianxia-jia/mcgf/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/tianxia-jia/mcgf/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Tianxia Jia.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
